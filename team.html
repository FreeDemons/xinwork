<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>首页</title>
<script src="js/mui.min.js"></script>
<script src="js/setting.js"></script>
<link href="css/mui.min.css" rel="stylesheet"/>
<link href="css/style.css" rel="stylesheet"/>
<link href="css/iconfont.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" charset="UTF-8">
mui.init({
	keyEventBind: {backbutton: false}//关闭back按键监听
});

mui.plusReady(function() {
	mui('.mui-scroll-wrapper').scroll({deceleration:0.001,bounce: true});
	plus.webview.currentWebview().setStyle({'popGesture':'none'});//关闭ios侧滑返回
	if(plus.storage.getItem('team')){showTeam(JSON.parse(plus.storage.getItem('team')));}
	loadTeam();
	//打开团队详情页
	mui.preload({id:'teamDetailt',url:'pages/team/teamDetailt.html'});
	mui('#teamList').on('tap', '.mui-table-view-cell', function() {
		mui.fire(plus.webview.getWebviewById('teamDetailt'),'load_team',{
		    tid:this.getAttribute("data-tid"),
		    phone:this.getAttribute("data-phone"),
		    title:this.getAttribute("data-title"),
		    name:this.querySelector(".team-title b").textContent,
		    logo:this.querySelector("img").getAttribute("src"),
		    place:this.querySelector(".team-place").textContent,
		    proof:this.querySelector(".team-title span").textContent,
		    description:this.querySelector(".team-description").textContent
		});
		mui.openWindow({id:'teamDetailt',show:{duration:200}});
	});
	//拨打加盟热线
	document.querySelector("#affiliate").addEventListener("tap",function(){
		var btnArray = ['取消','拨打'];
		var confirmText = '拨打加盟热线：15919187268';
		mui.confirm(confirmText,'',btnArray, function(e){
			if(e.index == 1){plus.device.dial("15919187268", true);}
		});
	});
});
//加载团队数据
function loadTeam(){
	plus.storage.setItem('teamUpdateTime',JSON.stringify(new Date().getTime()));
	var city = plus.storage.getItem('city') ? plus.storage.getItem('city') : '';
	mui.getJSON(XW.base + 'teamlist?city=' + city,function(data){
		plus.storage.setItem('team',JSON.stringify(data));
		showTeam(data);
	});
}
//显示团队项
function showTeam(data){
	if(data.length > 0){
		document.body.querySelector('#noneTips').style.display="none";
		var teamList = document.body.querySelector('#teamList');
		teamList.style.display="block";
		teamList.innerHTML = "";
		mui.each(data, function(i, n) {
			var li = document.createElement('li');
			li.setAttribute("data-tid",n.id);
			li.setAttribute("data-phone",n.field_team_phone);
			li.setAttribute("data-title",n.title);
			li.className = 'mui-table-view-cell mui-media';
			li.innerHTML = '<img class="mui-media-object mui-pull-left" src="' + n.field_logo.src + '"></img><div class="mui-media-body"><div class="team-title"><b>' + n.field_team_name + '</b><span>' + n.field_team_proof + '</span>'
							+ '</div><div class="team-description">' + n.field_team_description + '</div><p class="team-place mui-ellipsis"><span class="mui-icon mui-icon-location"></span>'
							+ n.field_team_address + '</p></div>';
			teamList.appendChild(li);
		});
	}else{
		document.body.querySelector('#teamList').style.display="none";
		document.body.querySelector('#noneTips').style.display="block";
	}
	
}
</script>
</head>
<body>
	<p id="affiliate" style="z-index: 100;position: relative;font-size: 12px;padding-left: 15px;background: #FCF2BF;color: #666;">城市合伙人加盟热线：15919187268（廖先生）</p>
	<div class="mui-content team-content mui-scroll-wrapper">
		<div class="mui-scroll">
			<ul class="mui-table-view" id="teamList"></ul>
			<div id="noneTips"><span class="mui-icon mui-block iconfont icon-nothing"></span>可怜，啥都没有 !</div>
		</div>
	</div>
</body>
</html>
