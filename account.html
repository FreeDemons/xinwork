<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>帐号</title>
<script src="js/mui.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/setting.js"></script>
<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
<script src="js/share.js" type="text/javascript" charset="utf-8"></script>
<link href="css/mui.min.css" rel="stylesheet"/>
<link href="css/iconfont.css" rel="stylesheet" type="text/css" />
<link href="css/account.css" rel="stylesheet"/>
<link rel="stylesheet" type="text/css" href="css/share.css"/>
<script type="text/javascript" charset="utf-8">
mui.init({
	keyEventBind: {
		backbutton: false  //关闭back按键监听
	}
});
var user;
var share = null;
mui.plusReady(function() {
	app.setUser();
	updateSerivces();
	mui('.mui-scroll-wrapper').scroll({startY: 0,deceleration:0.001,bounce: true});
	plus.webview.currentWebview().setStyle({'popGesture':'none'});//关闭ios侧滑返回
	//加载用户信息
	if(plus.storage.getItem('user')){
		hasUser(JSON.parse(plus.storage.getItem('user')));
	}else{
		noUser();
	}
	//点击登录头像
	document.querySelector("#accountUser").addEventListener('tap',function(){
		if(plus.storage.getItem('user') != null){
			mui.openWindow({url: "pages/account/accountSet.html",id: "accountSet"});
		}else{
			mui.openWindow({url: "pages/login/login.html",id: "login",show:{aniShow:"slide-in-bottom",duration:300}});
		}
	});
	//登录返回回调
	window.addEventListener("refresh",function(){
		user = event.detail.user;
		hasUser(user);
	});
	//点击列表选项
	mui(".mui-table-view").on("tap",".mui-table-view-cell",function(){
		if(this.hasAttribute("data-path")){
			if(plus.storage.getItem('user') == null && $(".mui-table-view-cell").index(this) < 5){
				mui.openWindow({url: "pages/login/login.html",id: "login",show:{aniShow:"slide-in-bottom",duration:300}});
			}else{
				mui.openWindow({url:this.getAttribute("data-path"),id:this.getAttribute("data-wid")});
			}
		}
	});
	var shareContent = '找兼职，不奔波，上薪窝。你来或不来，我都在这里，一起下载薪窝兼职APP玩转大学生活吧'
	var title = '对方撤回了一条信息并向你分享一个赚钱神器';
	var shareUrl = 'http://2bai.co/1000561';
	var msgwx={content:shareContent,href:shareUrl,title:title,extra:{scene:'WXSceneSession'}};
	var msgpy ={content:shareContent,href:shareUrl,title:title,extra:{scene:'WXSceneTimeline'}};
	var msgqq ={content:shareContent,href:shareUrl,title:title};
	mui('body').on('tap', '.mui-popover-action .shareItem', function() {
			mui('#shareJob').popover('toggle');
			if (share['weixin'] ||share['qq']) {
				switch (this.id){
							case 'weixin':
								shareAction(share['weixin'], msgwx);
								break;
							case 'pengyouquan':
								shareAction(share['weixin'], msgpy);
								break;
							case 'qq':
								shareAction(share['qq'],msgqq)
								break;
						}
			}
			else{
				mui.toast('系统发生错误，无法分享。');
			}
		})
	
});
//显示当前用户
function hasUser(data){
	if(data){
		user=data;
		var avatar = data.picture == null ? '<span class="mui-icon iconfont icon-camera"></span>' : '<img src="'+data.picture.urls+'"/>';
		$("#accountUser .mui-media-object").html(avatar);
		
		if(data.field_identity_group == ""){
			$(".mui-table-view-cell[data-wid='approve'] .mui-badge").show().attr("class","mui-badge mui-badge-inverted").text("未认证");
		}else{
			$(".mui-table-view-cell[data-wid='approve'] .mui-badge").show().attr("class","mui-badge mui-badge-success mui-badge-inverted").text("已认证");
		}
		
		$(".mui-table-view-cell[data-wid='wallet'] .mui-badge").show().find("font").text(data.userpoints.balance);
		$("#accountUser .mui-media-body").text(app.interceptionStr(data.name));
	}
}
//没有当前用户
function noUser(){
	user=null;
	$(".mui-table-view-cell a").find(".mui-badge").hide();
	$("#accountUser .mui-media-object").html('<span class="mui-icon iconfont icon-camera"></span>');
	$("#accountUser .mui-media-body").text("登录/注册");
}
</script>
</head>
<body>
	<div class="mui-scroll-wrapper mui-content" id="accountPage">
		<div class="mui-scroll">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell mui-media" id="accountUser">
					<a class="mui-navigate-right">
						<div class="mui-media-object mui-pull-left"></div>
						<div class="mui-media-body"></div>
					</a>
				</li>
			</ul>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell" data-path="pages/resume/resume.html" data-wid="resume">
					<a class="mui-navigate-right"><span class="mui-icon iconfont icon-resume"></span>个人简历</a>
				</li>
				<li class="mui-table-view-cell" data-path="pages/other/approve.html" data-wid="approve">
					<a class="mui-navigate-right">
						<span class="mui-icon iconfont icon-approve"></span>身份认证
						<span class="mui-badge mui-badge-inverted" style="display: none;"></span>
					</a>
				</li>
				<li class="mui-table-view-cell" data-path="pages/wallet/wallet.html" data-wid="wallet">
					<a class="mui-navigate-right">
						<span class="mui-icon iconfont icon-wallet"></span>我的钱包
						<span class="mui-badge mui-badge-success mui-badge-inverted" style="display: none;"><font></font> 积分</span>
					</a>
				</li>
				<li class="mui-table-view-cell" data-path="pages/record/record.html" data-wid="record">
					<a class="mui-navigate-right"><span class="mui-icon iconfont icon-jobrecord"></span>已报兼职</a>
				</li>
			</ul>
			
            <ul class="mui-table-view">
				<li class="mui-table-view-cell" data-path="pages/other/question.html" data-wid="question">
					<a class="mui-navigate-right"><span class="mui-icon iconfont icon-question"></span>常见问题</a>
				</li>
				<li class="mui-table-view-cell" data-path="pages/other/feedback.html" data-wid="feedback">
					<a class="mui-navigate-right"><span class="mui-icon iconfont icon-feedback"></span>意见反馈</a>
				</li>
			</ul>
			
			<ul class="mui-table-view">
				<li class="mui-table-view-cell" id = 'share'>
					<a class="mui-navigate-right" href="#shareApp"><span class="mui-icon iconfont icon-fenxiang"></span>分享有礼</a>
				</li>
				<li class="mui-table-view-cell" data-path="pages/other/about.html" data-wid="about">
					<a class="mui-navigate-right"><span class="mui-icon iconfont icon-about"></span>关于薪窝</a>
				</li>
			</ul>
		</div>
	</div>
		<div id="shareApp" class="mui-popover mui-popover-action mui-popover-bottom">
			<div class="share">
				<div class="shareList" >
					<div id = 'weixin' class="shareItem" style="background-color: #35D151;">
						<span class="mui-icon mui-icon-weixin icon"></span>
					</div>
					<p>微信</p>
				</div>
				<div class="shareList" >
					<div id = 'pengyouquan'  class="shareItem" style="background-color: #00D05C;">
						<span class="mui-icon mui-icon-pengyouquan icon"></span>
					</div>
					<p >朋友圈</p>
				</div>
				<div class="shareList">
					<div  id = 'qq' class="shareItem" style="background-color: #00A2EB;">
						<span class="mui-icon mui-icon-qq icon"></span>
						<p>QQ</p>
					</div>
				</div>
			</div>
			
		</div>
</body>
</html>
